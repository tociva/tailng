<!-- chips.component.html -->
<div [class]="containerClassFinal()">
  <!-- Chips row + input -->
  <div [class]="chipsWrapperClassFinal()">
    @for (chip of chips(); let i = $index; track i) {
      <span [class]="chipClassFinal()">
        @if (chipTpl) {
          <ng-container
            [ngTemplateOutlet]="chipTpl"
            [ngTemplateOutletContext]="{ $implicit: chip, index: i }"
          />
        } @else {
          <span [class]="chipLabelClassFinal()">{{ display(chip) }}</span>
        }

        <button
          type="button"
          [class]="removeButtonClassFinal()"
          [disabled]="disabledFinal()"
          (click)="removeAt(i)"
          aria-label="Remove chip"
        >
          Ã—
        </button>
      </span>
    }

    <input
      #inputEl
      type="text"
      [class]="inputClassFinal()"
      [value]="inputValue()"
      [placeholder]="placeholderText()"
      [disabled]="disabledFinal()"
      (input)="onInput($event)"
      (focus)="open('programmatic')"
      (blur)="onBlur()"
      (keydown)="onKeydown($event)"
      autocomplete="off"
      role="combobox"
      aria-autocomplete="list"
      [attr.aria-expanded]="isOpen()"
    />
  </div>

  <!-- Suggestions overlay -->
  <tng-overlay-ref
    #overlayRef="tngOverlayRef"
    [open]="isOpen()"
    (openChange)="onOverlayOpenChange($event)"
    (closed)="onOverlayClosed($event)"
  >
    <tng-connected-overlay
      [open]="overlayRef.isOpen()"
      [anchor]="inputEl"
      placement="bottom-start"
      width="anchor"
      (closed)="overlayRef.close($event)"
    >
      <tng-overlay-panel [slot]="overlayPanelSlot()">
        <tng-option-list
          [items]="options()"
          [activeIndex]="focusedIndex()"
          [displayWith]="displayWith()"
          [optionTemplate]="optionTpl ?? null"
          [loop]="false"
          [typeahead]="false"
          [slot]="optionListSlot()"
          (activeIndexChange)="focusedIndex.set($event)"
          (requestSelectActive)="requestSelectActive()"
          (optionMouseDown)="selectOption($event.item)"
          (optionHover)="focusedIndex.set($event)"
        />
      </tng-overlay-panel>
    </tng-connected-overlay>
  </tng-overlay-ref>
</div>
