<div [class]="containerClassFinal()">
  <!-- Trigger -->
  <button
    #triggerEl
    type="button"
    [class]="triggerButtonClassFinal()"
    [disabled]="isDisabled()"
    (click)="onTriggerClick()"
    (keydown)="onKeydown($event)"
    (blur)="onBlur()"
    aria-haspopup="listbox"
    [attr.aria-expanded]="isOpen()"
  >
    <span [class]="triggerValueClassFinal()">
      @if (currentValue()) {
        @if (valueTpl) {
          <ng-container
            [ngTemplateOutlet]="valueTpl"
            [ngTemplateOutletContext]="{ $implicit: currentValue()! }"
          />
        } @else {
          {{ display(currentValue()) }}
        }
      } @else {
        <span [class]="triggerPlaceholderClassFinal()">{{ placeholder() }}</span>
      }
    </span>

    <span [class]="triggerIconClassFinal()">â–¾</span>
  </button>

  <!-- Overlay -->
  <tng-overlay-ref
    #overlayRef="tngOverlayRef"
    [open]="isOpen()"
    (openChange)="onOverlayOpenChange($event)"
    (closed)="onOverlayClosed($event)"
  >
    <tng-connected-overlay
      [open]="overlayRef.isOpen()"
      [anchor]="triggerEl"
      placement="bottom-start"
      width="anchor"
      (closed)="overlayRef.close($event)"
    >
      <tng-overlay-panel [slot]="overlayPanelSlot()">
        <tng-option-list
          [items]="options()"
          [activeIndex]="activeIndex()"
          [displayWith]="displayWith()"
          [optionTemplate]="optionTpl ?? null"
          [loop]="false"
          [typeahead]="false"
          [slot]="optionListSlot()"
          (activeIndexChange)="onActiveIndexChange($event)"
          (requestSelectActive)="requestSelectActive()"
          (optionMouseDown)="select($event.item)"
          (optionHover)="activeIndex.set($event)"
        />
      </tng-overlay-panel>
    </tng-connected-overlay>
  </tng-overlay-ref>
</div>
